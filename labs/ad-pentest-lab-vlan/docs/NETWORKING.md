# Networking Architecture

## Overview

This lab uses a **hybrid networking model** combining NAT, Linux bridges, and VLAN-style segmentation to accurately simulate a real enterprise environment while remaining safe and reproducible on a single host.

The design intentionally separates **convenience networking** (internet access) from **attack-surface networking** (enterprise VLANs).

---

## Network Types Used

### 1. NAT Network (Management Only)

**Purpose:**

- Internet access for package updates and tooling
- Not part of the attack simulation

**Characteristics:**

- Provided by libvirt / Vagrant
- DHCP-based
- No inbound access from VLAN networks
- Logically out-of-scope for exploitation

> NAT exists strictly for usability, not realism.

---

### 2. VLAN Networks (Enterprise Segmentation)

**Purpose:**

- Simulate internal enterprise network segmentation
- Enforce Layer 2 isolation between security zones

**Implementation:**

- Linux bridges on the host
- One bridge per VLAN
- No routing, no gateway, no firewall by default

**Security Properties:**

- Each VLAN is a separate broadcast domain
- Hosts cannot communicate across VLANs without routing
- Accurately models switch-level segmentation

---

## VLAN Layout

| VLAN ID | Name             | Subnet         | Purpose                 |
| ------- | ---------------- | -------------- | ----------------------- |
| 10      | Management / AD  | 172.28.10.0/24 | Domain infrastructure   |
| 20      | Workstations     | 172.28.20.0/24 | User endpoints          |
| 30      | Servers & DevOps | 172.28.30.0/24 | Internal services       |
| 40      | DMZ              | 172.28.40.0/24 | External-facing systems |
| 99      | Attacker         | 172.28.99.0/24 | Red team platform       |

---

## pfSense Firewall (Layer 3 Control)

**Default State:** OFF

When powered on, pfSense:

- Becomes the **only Layer 3 routing device**
- Provides controlled inter-VLAN routing
- Enforces firewall rules between segments
- Enables pivoting, relay, and bypass scenarios

This mirrors a real enterprise perimeter and internal firewall deployment.

---

## Attack Surface States

### pfSense OFF (Default)

- No inter-VLAN communication
- Full Layer 2 isolation
- Single-segment exploitation only

### pfSense ON

- Inter-VLAN routing enabled
- Firewall rule testing
- Lateral movement and pivoting
- Segmentation bypass scenarios

---

## Design Decisions (Why This Matters)

- Linux bridges were chosen over NAT-only networking to model **real enterprise behavior**
- No host-level routing prevents unrealistic shortcuts
- Attack paths must be earned through exploitation, not topology

This makes the lab suitable for **professional red team training**, not just CTF-style exercises.

---

## Related Files

- `scripts/setup-vlans.sh` – Creates VLAN bridges on the host
- `scripts/attach-vms-to-vlans.sh` – Connects VMs to VLAN bridges
- `scripts/test-vlans.sh` – Verifies segmentation and isolation
- `diagrams/` – Network diagrams and topology visuals
